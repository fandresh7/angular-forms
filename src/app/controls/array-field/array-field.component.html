<fieldset [formArrayName]="control().name">
  @if (control().label) {
    <legend [class]="settings.legendClasses">{{ control().label }}</legend>
  }

  @for (group of formControl.controls; track group; let i = $index) {
    <div
      [formGroupName]="i"
      [class]="settings.arrayItemContainerClasses">
      @for (ctrl of control().controls; track ctrl.name) {
        <ng-container
          *activateControl="ctrl"
          [ngComponentOutlet]="controlResolver.resolve(ctrl) | async"
          [ngComponentOutletInjector]="ctrl | controlInjector: getControlValue(i)" />
      }

      <button
        [class]="settings.arrayControlRemoveButtonClasses"
        role="button"
        tabindex="0"
        type="button"
        (click)="removeItem(i)"
        (keydown.enter)="removeItem(i)">
        @if (settings.arrayControlRemoveButtonIcon) {
          <div [class]="settings.arrayControlRemoveButtonIconClasses">
            <ng-container *ngComponentOutlet="settings.arrayControlRemoveButtonIcon" />
          </div>
        }
        @if (settings.arrayControlRemoveButtonLabel) {
          <span>{{ settings.arrayControlRemoveButtonLabel }}</span>
        }
      </button>
    </div>
  }

  <button
    [class]="settings.arrayControlAddButtonClasses"
    role="button"
    tabindex="0"
    type="button"
    (click)="addItem()"
    (keydown.enter)="addItem()">
    @if (settings.arrayControlAddButtonIcon) {
      <div [class]="settings.arrayControlAddButtonIconClasses">
        <ng-container *ngComponentOutlet="settings.arrayControlAddButtonIcon" />
      </div>
    }
    @if (settings.arrayControlAddButtonLabel) {
      <span>{{ settings.arrayControlAddButtonLabel }}</span>
    }
  </button>
</fieldset>

<div [class]="settings.validationFeedbackClasses">
  <ng-container [helpMessage]="control().helpText" />
</div>
